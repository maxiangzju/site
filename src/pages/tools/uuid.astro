---
import BaseLayout from '../../components/layout/BaseLayout.astro';
---

<BaseLayout title="UUID Generator | Xiang's Island">
  <div class="max-w-4xl mx-auto px-4 py-16">
    <div class="mb-8">
      <a href="/tools" class="text-[var(--color-primary)] hover:underline mb-2 inline-block">← Back to Tools</a>
      <h1 class="text-3xl font-bold mb-2">UUID Generator</h1>
      <p class="text-[var(--color-text-muted)]">
        Generate random Universally Unique Identifiers (UUIDs v4).
      </p>
    </div>

    <div class="mb-6">
      <div class="flex items-center justify-between mb-3">
        <label class="text-lg font-semibold">Generated UUIDs</label>
        <div class="flex gap-2">
          <button
            id="clearAllBtn"
            class="px-3 py-1 text-sm bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded hover:border-[var(--color-primary)] transition-colors"
          >
            Clear All
          </button>
          <button
            id="copyAllBtn"
            class="px-3 py-1 text-sm bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded hover:border-[var(--color-primary)] transition-colors"
          >
            Copy All
          </button>
        </div>
      </div>
      <div
        id="uuidList"
        class="min-h-[300px] p-4 bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded-lg"
      >
        <p class="text-[var(--color-text-muted)] text-center py-8">Click "Generate UUID" to create one</p>
      </div>
    </div>

    <div class="flex flex-wrap gap-3 mb-6">
      <button
        id="generateBtn"
        class="px-6 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary-dark)] transition-colors font-medium"
      >
        Generate UUID
      </button>
      <button
        id="generateMultipleBtn"
        class="px-6 py-2 bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded-lg hover:border-[var(--color-primary)] transition-colors"
      >
        Generate 10
      </button>
      <label class="flex items-center gap-2 px-4 py-2 bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded-lg">
        <input type="checkbox" id="uppercaseCheck" class="w-4 h-4" />
        <span class="text-sm">Uppercase</span>
      </label>
      <label class="flex items-center gap-2 px-4 py-2 bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded-lg">
        <input type="checkbox" id="noDashesCheck" class="w-4 h-4" />
        <span class="text-sm">Remove Dashes</span>
      </label>
    </div>

    <div id="statusMessage" class="mt-4 p-3 rounded-lg hidden"></div>

    <div class="mt-8 p-4 bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded-lg">
      <h2 class="font-semibold mb-2">About UUIDs</h2>
      <p class="text-[var(--color-text-muted)] text-sm mb-2">
        UUID (Universally Unique Identifier) is a 128-bit label used for identification in software.
        This tool generates version 4 UUIDs which are randomly generated.
      </p>
      <p class="text-[var(--color-text-muted)] text-sm">
        Format: <code class="bg-[var(--color-bg)] px-1 rounded">xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx</code>
        where x is any hexadecimal digit and y is one of 8, 9, A, or B.
      </p>
    </div>
  </div>
</BaseLayout>

<script>
  const uuidList = document.getElementById('uuidList') as HTMLDivElement;
  const generateBtn = document.getElementById('generateBtn') as HTMLButtonElement;
  const generateMultipleBtn = document.getElementById('generateMultipleBtn') as HTMLButtonElement;
  const clearAllBtn = document.getElementById('clearAllBtn') as HTMLButtonElement;
  const copyAllBtn = document.getElementById('copyAllBtn') as HTMLButtonElement;
  const uppercaseCheck = document.getElementById('uppercaseCheck') as HTMLInputElement;
  const noDashesCheck = document.getElementById('noDashesCheck') as HTMLInputElement;
  const statusMessage = document.getElementById('statusMessage') as HTMLDivElement;

  const uuids: string[] = [];

  function showStatus(message: string, isError = false) {
    statusMessage.textContent = message;
    statusMessage.className = `mt-4 p-3 rounded-lg ${
      isError
        ? 'bg-red-900/30 border border-red-500/50 text-red-300'
        : 'bg-green-900/30 border border-green-500/50 text-green-300'
    }`;
    statusMessage.classList.remove('hidden');
    setTimeout(() => statusMessage.classList.add('hidden'), 3000);
  }

  function generateUUID(): string {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
      const r = (Math.random() * 16) | 0;
      const v = c === 'x' ? r : (r & 0x3) | 0x8;
      return v.toString(16);
    });
  }

  function formatUUID(uuid: string): string {
    let formatted = uuid;
    if (noDashesCheck.checked) {
      formatted = formatted.replace(/-/g, '');
    }
    if (uppercaseCheck.checked) {
      formatted = formatted.toUpperCase();
    }
    return formatted;
  }

  function renderUUIDs() {
    if (uuids.length === 0) {
      uuidList.innerHTML = '<p class="text-[var(--color-text-muted)] text-center py-8">Click "Generate UUID" to create one</p>';
      return;
    }

    uuidList.innerHTML = uuids
      .map(
        (uuid, index) => `
        <div class="flex items-center justify-between p-3 mb-2 bg-[var(--color-bg)] rounded border border-[var(--color-border)] hover:border-[var(--color-primary)] transition-colors group">
          <code class="text-sm font-mono text-[var(--color-text)]">${uuid}</code>
          <button
            class="px-2 py-1 text-xs bg-[var(--color-bg-secondary)] border border-[var(--color-border)] rounded opacity-0 group-hover:opacity-100 transition-opacity hover:border-[var(--color-primary)]"
            onclick="copyUUID('${uuid}', ${index})"
          >
            Copy
          </button>
        </div>
      `
      )
      .join('');
  }

  (window as any).copyUUID = async (uuid: string, index: number) => {
    await navigator.clipboard.writeText(uuid);
    showStatus(`✓ UUID ${index + 1} copied to clipboard!`);
  };

  generateBtn.addEventListener('click', () => {
    const uuid = formatUUID(generateUUID());
    uuids.unshift(uuid);
    renderUUIDs();
    showStatus('✓ UUID generated');
  });

  generateMultipleBtn.addEventListener('click', () => {
    for (let i = 0; i < 10; i++) {
      uuids.unshift(formatUUID(generateUUID()));
    }
    renderUUIDs();
    showStatus('✓ 10 UUIDs generated');
  });

  clearAllBtn.addEventListener('click', () => {
    uuids.length = 0;
    renderUUIDs();
    showStatus('✓ All UUIDs cleared');
  });

  copyAllBtn.addEventListener('click', async () => {
    if (uuids.length === 0) {
      showStatus('No UUIDs to copy', true);
      return;
    }
    await navigator.clipboard.writeText(uuids.join('\n'));
    showStatus(`✓ ${uuids.length} UUIDs copied to clipboard!`);
  });

  uppercaseCheck.addEventListener('change', () => {
    for (let i = 0; i < uuids.length; i++) {
      let uuid = uuids[i].toLowerCase().replace(/-/g, '');
      uuid = uuid.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/, '$1-$2-$3-$4-$5');
      uuids[i] = formatUUID(uuid);
    }
    renderUUIDs();
  });

  noDashesCheck.addEventListener('change', () => {
    for (let i = 0; i < uuids.length; i++) {
      let uuid = uuids[i].toLowerCase().replace(/-/g, '');
      uuid = uuid.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/, '$1-$2-$3-$4-$5');
      uuids[i] = formatUUID(uuid);
    }
    renderUUIDs();
  });
</script>
