---
import { getCollection } from 'astro:content';
import BaseLayout from '../../components/layout/BaseLayout.astro';

const posts = (await getCollection('blog'))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title="Blog | Xiang's Island">
  <div class="max-w-4xl mx-auto px-4 py-16">
    <h1 class="text-3xl font-bold mb-8">Blog</h1>

    {posts.length === 0 ? (
      <p class="text-[var(--color-text-muted)]">No posts yet. Check back soon!</p>
    ) : (
      <ul class="space-y-8">
        {posts.map(post => (
          <li>
            <article class="bg-[var(--color-bg-secondary)]/50 border border-[var(--color-border)] rounded-lg p-6 hover:border-[var(--color-primary)] hover:bg-[var(--color-bg-secondary)] transition-all">
              <a href={`/blog/${post.id}`} class="block">
                <h2 class="text-xl font-semibold mb-2 hover:text-[var(--color-primary)]">
                  {post.data.title}
                </h2>
                <p class="text-[var(--color-text-muted)] mb-3">
                  {post.data.description}
                </p>
                <div class="flex items-center gap-4 text-sm text-[var(--color-text-muted)]">
                  <time datetime={post.data.pubDate.toISOString()}>
                    {post.data.pubDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric'
                    })}
                  </time>
                  {post.data.tags.length > 0 && (
                    <div class="flex gap-2">
                      {post.data.tags.map(tag => (
                        <span class="bg-[var(--color-border)] px-2 py-0.5 rounded text-[var(--color-text-muted)]">
                          {tag}
                        </span>
                      ))}
                    </div>
                  )}
                </div>
              </a>
            </article>
          </li>
        ))}
      </ul>
    )}
  </div>
</BaseLayout>
